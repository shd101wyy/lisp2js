var node_environment=!1,vm=null;"undefined"!=typeof module&&(vm=require("vm"),node_environment=!0);var $List,car,cdr,cons,list,list_module,__slice=[].slice;
list_module=function(){var p,r,b;p=function(b,g){this.first=b;this.rest=g;return null};p.prototype.length=function(){var b;b=function(g,m){return null===g?m:b(g.rest,m+1)};return b(this,0)};p.prototype.toString=function(){var b;b=function(g,m){return null===g?m+")":g instanceof p?b(g.rest,m+(null===g.first?"()":g.first.toString())+(null===g.rest?"":", ")):m.slice(0,-2)+" . "+g.toString()+")"};return b(this,"(")};p.prototype.reverse=function(){var b;b=function(g,m){return g instanceof p?b(g.rest,r(g.first,
m)):null===g?m:r(g,m)};return b(this,null)};p.prototype.slice=function(b,g){var m,p,t;null==g&&(g=null);if(null===g)return 0>b&&(b=this.length()+b),p=function(b,g){return 0===g?b:p(b.rest,g-1)},p(this,b);if(0>b||0>g)m=this.length(),b=0>b?m+b:b,g=0>g?m+g:g;t=function(b,g,m){return 0===g?0===m||null===b?null:r(b.first,t(b.rest,g,m-1)):t(b.rest,g-1,m)};return t(this,b,g-b)};p.prototype.ref=function(b){var g;0>b&&(b=this.length()+b);g=function(b,s){return null===b?null:0===s?b.first:g(b.rest,s-1)};return g(this,
b)};p.prototype.append=function(){var s,g;g=1<=arguments.length?__slice.call(arguments,0):[];g=b.apply(b,g);s=function(b,g){return null===b?g:r(b.first,s(b.rest,g))};return s(this,g)};p.prototype.toArray=function(){var b,g;b=[];g=function(m){if(null===m)return b;b.push(m.first);return g(m.rest)};return g(this)};p.prototype.forEach=function(b){var g;g=function(m){if(null===m)return null;b(m.first);return g(m.rest)};return g(this)};p.prototype.foreach=p.prototype.forEach;p.prototype.map=function(b){var g;
g=function(m){return null===m?null:r(b(m.first),g(m.rest))};return g(this)};p.prototype.filter=function(b){var g;g=function(m){return null===m?null:b(m.first)?r(m.first,g(m.rest)):g(m.rest)};return g(this)};r=function(b,g){return new p(b,g)};b=function(){var b,g;b=1<=arguments.length?__slice.call(arguments,0):[];g=function(b,p){return p===b.length?null:r(b[p],g(b,p+1))};return g(b,0)};return{list:b,cons:r,List:p,car:function(b){return b.first},cdr:function(b){return b.rest}}}();$List=list_module.List;
list=list_module.list;cons=list_module.cons;car=list_module.car;cdr=list_module.cdr;"undefined"!==typeof module&&(module.exports.$List=$List,module.exports.list=list,module.exports.cons=cons,module.exports.car=car,module.exports.cdr=cdr);
var lisp_module=function(){var p,r,b,s,g={},m="",A=null,t=0,B=function(a,b){return null===a?b instanceof $List||null===b?b:cons(b,null):cons(a.first,B(a.rest,b))};node_environment?A=vm.createContext({cons:cons,car:car,cdr:cdr,list:list,$List:$List,append:B,console:console}):window.append=B;p=function(a){for(var b=[],f=0,d=0;d<a.length;d++)if("("===a[d])b.push("("),f++;else if("["===a[d]){if(0!==d&&" "!==a[d-1]&&"\n"!==a[d-1]&&"\t"!==a[d-1]&&"'"!==a[d-1]&&"`"!==a[d-1]&&"~"!==a[d-1]&&"("!==a[d-1]&&
"{"!==a[d-1]&&"["!==a[d-1])if(c=b.length-1,h=")"===b[c]?1:0,0===h)b.push("get"),b.push(b[c]),b[c]="(";else{b.push("");b.push("");b[c+2]=b[c];for(--c;;){b[c+2]=b[c];")"===b[c]&&h++;"("===b[c]&&h--;if(0===h)break;c--}b[c]="(";b[c+1]="get"}else b.push("("),b.push("Array");f++}else if("{"===a[d])b.push("("),b.push("Object"),f++;else if(")"===a[d]||"]"===a[d]||"}"===a[d])b.push(")"),f--;else if(" "!==a[d]&&"\n"!==a[d]&&"\t"!=a[d]&&","!=a[d])if("~"===a[d]&&"@"===a[d+1])b.push("~@"),d++;else if("`"===a[d]||
"~"===a[d]||"'"===a[d])b.push(a[d]);else if(";"===a[d])for(;d!=a.length&&"\n"!==a[d];)d++;else if('"'===a[d]){for(var e=d+1;e!=a.length;)if("\\"===a[e])e+=2;else{if('"'===a[e])break;e++}b.push(a.slice(d,e+1));d=e}else{for(e=d+1;e!==a.length&&" "!==a[e]&&"\n"!==a[e]&&"\t"!==a[e]&&","!==a[e]&&")"!==a[e]&&"("!==a[e]&&"]"!==a[e]&&"["!==a[e]&&"{"!==a[e]&&"}"!==a[e]&&"'"!==a[e]&&"`"!==a[e]&&"~"!==a[e]&&";"!==a[e]&&":"!==a[e]&&"."!==a[e];)e+=1;var g=a.slice(d,e);if("."===g[0]&&")"===b[b.length-1]&&" "!==
a[d-1]&&"\n"!==a[d-1]&&"\t"!==a[d-1]){var h=1,c=b.length-1;b.push("");b.push("");b[c+2]=b[c];for(--c;;){b[c+2]=b[c];")"===b[c]&&h++;"("===b[c]&&h--;if(0===h)break;c--}b[c]="(";b[c+1]="get";b.push('"'+g.slice(1)+'"');b.push(")")}else"."===g[0]&&0<d&&" "!==a[d-1]&&"\t"!==a[d-1]&&"\n"!==a[d-1]&&"{"!==a[d-1]&&"("!==a[d-1]&&"}"!==a[d-1]&&")"!==a[d-1]?(d=b[b.length-1],b[b.length-1]="(",b.push("get"),b.push(d),b.push('"'+g.slice(1)+'"'),b.push(")")):"."===g[0]&&'"'===a[d-1]?b[b.length-1]+=g:b.push(g);d=
e-1}return 0!==f?null:b};r=function(a){var b={"'":"quote","~":"unquote","~@":"unquote-splice","`":"quasiquote"};if(null===a)return null;var f=null,d,e=null,g=null;for(d=a.length-1;0<=d;d--)")"===a[d]?(e=cons(f,e),f=null):"("===a[d]?(0===d||"~@"!==a[d-1]&&"'"!==a[d-1]&&"~"!==a[d-1]&&"`"!==a[d-1]?f=cons(f,car(e)):(f=cons(cons(b[a[d-1]],cons(f,null)),car(e)),d--),e=cdr(e)):(g=a[d],0===d||"~@"!==a[d-1]&&"'"!==a[d-1]&&"~"!==a[d-1]&&"`"!==a[d-1]?f=cons(g,f):(f=cons(cons(b[a[d-1]],cons(g,null)),f),d--));
return f};var z=function(a){if(null===a)return null;var b=a.first;return b instanceof $List?cons("cons",cons(z(b),cons(z(a.rest),null))):"string"===typeof b&&"."===b?cons("quote",cons(a.rest.first,null)):cons("cons",cons(cons("quote",cons(b,null)),cons(z(cdr(a)),null)))},C=function(a){for(var b="",f=0;f<a.length;f++)var d=a.charCodeAt(f),b=47<d&&58>d||64<d&&91>d||96<d&&123>d||"$"===a[f]||"_"===a[f]||"."===a[f]||"&"===a[f]||255<d?b+a[f]:b+("_$"+d+"_");isNaN(b[0])||(b="_"+b);return b},w=function(a){if(null===
a)return null;v=a.first;return v instanceof $List?"string"===typeof v.first&&"unquote"===v.first?cons("cons",cons(v.rest.first,cons(w(cdr(a)),null))):"string"==typeof v.first&&"unquote-splice"===v.first?cons("append",cons(v.rest.first,cons(w(a.rest),null))):cons("cons",cons(w(v),cons(w(a.rest),null))):"string"===typeof v&&"."===v?cons("quote",cons(a.rest.first,null)):cons("cons",cons(cons("quote",cons(v,null)),cons(w(a.rest),null)))},x=function(a,b,f){if(null===a&&null===b)return f;if(null===a&&null!==
b||null!==a&&null===b&&"."!==a.first)return 0;if(a.first instanceof $List&&b.first instanceof $List)return x(a.first,b.first,f)?x(a.rest,b.rest,f):0;if(a.first instanceof $List&&!(b.first instanceof $List))return 0;if("string"===typeof a.first&&"#"===a.first[0])return"string"!==typeof b.first?0:a.first.slice(1)===b.first?x(a.rest,b.rest,f):0;if("string"===typeof a.first&&"."===a.first)return f[a.rest.first]=b,f;f[a.first]=b.first;return x(a.rest,b.rest,f)},F=function(a,g){for(var f=function(a){if(null===
a)return null;if(a.first instanceof $List)return cons(cons("list",f(a.first)),f(a.rest));if('"'===a.first[0]){for(var b="",c=0;c<a.first.length;c++)b='"'===a.first[c]?b+'\\"':"\\"===a.first[c]?b+"\\\\":"\n"===a.first[c]?b+"\\n":"\t"===a.first[c]?b+"\\t":b+a.first[c];return cons('"'+b+'"',f(a.rest))}return null===a.first?cons(a.first,f(a.rest)):cons('"'+a.first+'"',f(a.rest))};null!==a;){var d=x(a.first,g,{});if(d){var e="(function(){",l;for(l in d)e=d[l]instanceof $List?e+("var "+l+" = "+b(cons("list",
f(d[l])))+";"):null===d[l]?e+("var "+l+" = null; "):e+("var "+l+" = "+b('"'+d[l])+'";');e+="return ("+b(a.rest.first)+");";e+="})();";if(node_environment)try{return vm.runInContext(e,A,"lisp.vm")}catch(h){return console.log(h),""}else try{return window.eval(e)}catch(c){return console.log(c),""}}a=a.rest.rest}console.log("ERROR: Failed to expand macro\n");return""},y=function(a){for(var g="",f=!1;null!==a;){var d=a.first,d=b(d,null,null,null,!0);if("string"===typeof d&&":"===d[0])for(!1===f?(g+="(",
f=!0):g+=", ",g+="{"+d.slice(1)+": "+b(a.rest.first,null,null,null,!0),a=a.rest.rest;;){if(null===a){g+="}";break}d=b(a.first,null,null,null,!0);if(":"!==d[0]){g+="}, "+d;break}if(null===a.rest)return console.log("ERROR: Invalid parameter name"),"";var e=b(a.rest.first,null,null,null,!0),g=g+(", "+d.slice(1)+": "+e);a=a.rest.rest}else!1===f?(g+="(",f=!0):g+=", ",g+=d;if(null===a||null===a.rest)break;a=a.rest}f&&(g+=")");return 0===g.trim().length?"()":g},D=function(a){return C(a)===a&&isNaN(a)?a:
'"'+a+'"'},E=function(a){if('"'===a[0]||"."==a[0]){var b="."===a[0]?a.slice(1):a.slice(1,-1);return b===C(b)&&isNaN(b)?"."+b:"["+a+"]"}return"["+a+"]"};b=function(a,m,f,d,e,l){if(null===a)return d?"return null":"null";if(a instanceof $List){var h=car(a),c,n,q,k;if("def"===h||":="===h||"="===h||"set!"===h||"const"===h)return n=car(cdr(a)),q=null===cdr(cdr(a))?null:null!==cdr(cdr(cdr(a)))?cons("fn",cons(car(cdr(cdr(a))),cdr(cdr(cdr(a))))):a.rest.rest.first,n=b(n),q=b(q,null,null,null,!0,n),c=("def"===
h||":="===h?"var ":"const"===h?"const ":"")+n+" = "+q+" ",d?c+"; return "+n:c;if("Array"===h){c=d?"return [":"[";for(a=cdr(a);null!==a;)c+=b(car(a),null,null,null,!0),null!==cdr(a)&&(c+=", "),a=cdr(a);return c+"]"}if("Object"===h){c=d?"return {":"{";for(a=a.rest;null!==a;){k=b(a.first,null,null,null,!0);if(":"===k[0])if(null!==a.rest&&":"!==a.rest.first[0])d=D(k.slice(1)),c+=d+": ";else{c+=k.slice(1)+(null===a.rest?"":", ");a=a.rest;continue}else c="'"===k[0]||'"'===k[0]?c+(k+": "):c+("["+k+"]: ");
d=b(a.rest.first,null,null,null,!0);c+=d;null!==a.rest.rest&&(c+=", ");a=a.rest.rest}return c+="}"}if("quote"===h||"quasiquote"===h)return a.rest.first instanceof $List?(e=b("quote"===h?z(a.rest.first):w(a.rest.first)),d?"return "+e:e):null===a.rest?d?"return null":"null":isNaN(a.rest.first)?d?'return "'+a.rest.first+'"':'"'+a.rest.first+'"':d?"return "+a.rest.first:a.rest.first;if("fn"===h||"fn*"===h||"\u03bb"===h||"\u03bb*"===h){c="fn"===h||"\u03bb"===h?"function ":"function* ";d&&(c="return "+
c);d="";"string"===typeof a.rest.first?(l=a.rest.first,d+=a.rest.first+"(",e=a.rest.rest.first,a=a.rest.rest.rest):(d+="(",e=a.rest.first,a=a.rest.rest);m=[];for(var p={},h=0,r=!1,u=null;null!==e;)if(f=e.first,"string"!==typeof f){if("Object"!==f.first)return console.log("ERROR: Invalid parameters"),"";h++;for(f=f.rest;null!==f;)n=b(f.first),n='"'===n[0]?n.slice(1,-1):n,n=":"===n[0]?n.slice(1):n,q=b(f.rest.first,null,null,null,!0),p[n]=q,f=f.rest.rest;d+="__lisp_args__";e=e.rest;null!==e&&"&"!==e.first&&
"."!==e.first&&(d+=", ");m.push(p)}else{f=b(f);if("&"===f){h++;u=b(e.rest.first);break}else if("."===f){h++;e=e.rest;u=b(e.first);r=!0;break}else if(":"===f[0]){h++;f=f.slice(1);d+=f;m.push([f,b(e.rest.first,null,null,null,!0)]);e=e.rest.rest;null!==e&&"&"!==e.first&&"."!==e.first&&(d+=", ");continue}else h++,d+=f,null!==e.rest&&"&"!==e.rest.first&&"."!==e.rest.first&&(d+=", ");e=e.rest}f=[l?l:!1];d+="){";u&&(d+="for(var "+u+" = [], $__0 = "+(h-1)+"; $__0 < arguments.length; $__0++)"+u+"[$__0 - "+
(h-1)+"] = arguments[$__0];",r&&(d+=u+" = list.apply(null, "+u+");"));for(q=0;q<m.length;q++)if(e=m[q],e.constructor===Array)n=e[0],d+=n+" = ("+n+" === void 0 ? "+e[1]+" : "+n+" );";else for(k in d+="var __lisp_args_v__;",d+="__lisp_args__ = (__lisp_args__ === void 0 ? {} : __lisp_args__); ",e)d+="var "+k+" = ((__lisp_args_v__ = __lisp_args__."+k+") === void 0 ? "+e[k]+" : __lisp_args_v__); ";d+=s(a,!0,null,f);!1!==f[0]&&f[0]!==l&&(c+=f[0]);return c+(d+"}")}if("let"===h){f={};e=cdr(a);for(c="((function(){";null!==
e.rest;)n=e.first,l=e.rest.first,typeof("string"===n)?n in f?c+=n+" = "+b(l)+";":(f[n]=!0,c+="var "+n+" = "+b(l)+";"):console.log("let implementation not finished yet"),e=e.rest.rest;c+=b(e.first,null,null,!0);c+="})())";return(d?"return ":"")+c}if("cond"===h){n=!1;k=a.rest;c="if(";e&&(c="(function(){"+c);q=b(k.first,null,null,null,!0,null);c=c+q+"){";a=k.rest.first;c+=b(a,!0,f,d||e,null,l);c+="}";for(k=k.rest.rest;null!==k;)if(c+=" else ","else"!==k.first)c+="if (",q=b(k.first,null,null,null,!0),
c=c+q+"){",a=k.rest.first,c+=b(a,!0,f,d||e,null,l),c+="}",k=k.rest.rest;else{n=!0;c+="{";a=k.rest.first;c+=b(a,!0,f,d||e,null,l);c+="}";break}!1===n&&d&&(c+=" else return null");e&&(c+="})()");return c}if("if"===h)return c="(",q=a.rest.first,l=a.rest.rest.first,a=null===a.rest.rest.rest?null:a.rest.rest.rest.first,e?(c+=b(q,null,null,null,!0)+" ? ",c+=b(l,m,f,null,!0,null)+" : ",c+=b(a,m,f,null,!0,null)+")"):null===a?b(list("cond",q,l),m,f,d,e):b(list("cond",q,l,"else",a),m,f,d,e);if("do"===h)return e?
"(function (){"+s(a.rest,!0)+"})()":s(a.rest,d,null,f);if("apply"===h)return l=b(a.rest.first),e=b(a.rest.rest.first,null,null,null,!0),(d?"return ":"")+"("+l+").apply(this, (function(){var temp = "+e+"; return temp instanceof $List ? temp.toArray() : temp})())";if("new"===h)return l=b(a.rest.first),c="(new "+l+""+y(a.rest.rest),c+=")",(d?"return ":"")+c;if("+"===h||"-"===h||"*"===h||"/"===h||"%"===h||"=="===h||"<"===h||">"===h||"!="===h||"<="===h||">="===h||"&&"===h||"||"===h||"&"===h||"|"===h||
"and"===h||"or"===h){c="(";e=a.rest;if(null===e.rest)return"+"===h||"*"===h||"%"===h?(d?"return ":"")+b(e.first,null,null,null,!0):"-"===h?(d?"return ":"")+"(-"+b(e.first,null,null,null,!0)+")":"/"===h?(d?"return ":"")+"(1/"+b(e.first,null,null,null,!0)+")":(d?"return ":"")+"true";f=b(e.first,null,null,null,!0);c+=f;for(e=e.rest;null!==e;)f=b(e.first,null,null,null,!0),"and"===h?h="&&":"or"===h?h="||":"=="==h&&(h="==="),c+=" "+h+" ",c+=f,null===e.rest||"==="!==h&&"<"!==h&&">"!==h&&"!="!==h&&"<="!==
h&&">="!==h||(c+=" && "+f),e=e.rest;return(d?"return ":"")+c+")"}if("case"===h){n=!1;c=a.rest.first;c=b(c,null,null,null,!0);k=a.rest.rest;c="switch ("+c+"){";for(e&&(c="(function(){"+c);null!==k;)if("else"!==k.first)c+=" case ",q=b(k.first,null,null,null,!0),c+=q+":",a=k.rest.first,c+=b(a,!0,f,d||e,null,l),c+=";"===c[c.length-1]?"":";",d||e||(c+=" break;"),k=k.rest.rest;else{n=!0;c+=" default: ";a=k.rest.first;c+=b(a,!0,f,d||e,null,l);c+=";"===c[c.length-1]?"":";";d||e||(c+=" break;");break}!1===
n&&d&&(c+=" default: return null;");c+="}";e&&(c+="})()");return c}if("not"===h)return(d?"return ":"")+"(!"+b(a.rest.first,null,null,null,!0)+")";if("instanceof"===h)return(d?"return ":"")+"("+b(a.rest.first)+" instanceof "+b(a.rest.rest.first)+")";if("get"===h){c=e=b(a.rest.first,null,null,null,!0);for(f=a.rest.rest;null!==f;)k=b(f.first,null,null,null,!0),c+=E(k),f=f.rest;return(d?"return ":"")+c}if("->"===h){c=e=b(a.rest.first,null,null,null,!0);for(f=a.rest.rest;null!==f;)l=!1,f.first instanceof
$List?(l=!0,k=b(f.first.first,null,null,null,!0)):k=b(f.first,null,null,null,!0),c+=E(k),l&&(e=f.first.rest,c+=y(e)),f=f.rest;return(d?"return ":"")+c}if("loop"===h){c=[];h=[];for(k=a.rest;null!==k.rest;)n=b(k.first),q=b(k.rest.first,null,null,null,!0),c.push(n),h.push(q),k=k.rest.rest;r=n=null;for(q=c.length-1;0<=q;q--)n=cons(c[q],n),r=cons(h[q],r);a=k.first;return b(cons(list("fn",n,a),r),m,f,d,e,l)}if("try"===h)return k=a.rest,a=k.first,c="try{"+b(a,!0,f,d||e,null,l),c+="}",k=k.rest,null!==k&&
"catch"===k.first&&(c+="catch(",a=b(k.rest.first),c+=a+"){",a=k.rest.rest.first,c+=b(a,!0,f,d||e,null,l),c+="}",k=k.rest.rest.rest),null!==k&&"finally"===k.first&&(a=k.rest.first,c+="finally {",c+=b(a,!0,f,d||e,null,l),c+="}"),c;if("throw"===h||"yield"===h)return h+" "+b(a.rest.first,null,null,null,!0)+(d?"; return;":"");if("in"===h)return(d?"return ":"")+"("+b(a.rest.first)+" in "+b(a.rest.rest.first)+")";if("class"===h){f=a.rest.first;k=l=null;c=f+".prototype = {constructor: "+f+"";"extends"===
a.rest.rest.first&&(k=a.rest.rest.rest.first,a=a.rest.rest,c+=", __proto__: "+k+".prototype");for(a=a.rest.rest;null!==a;){k=b(a.first,null,null,null,!0);if(":"===k[0])if(k=D(k.slice(1)),"constructor"===k){if(null!==l)return console.log("ERROR: redefine the constructor for class "+f),"";l=a.rest.first;a=a.rest.rest;continue}else c+=", ",c+=k+": ";else"'"===k[0]||'"'===k[0]?(c+=", ",c+=k+": "):(c+=", ",c+="["+k+"]: ");q=b(a.rest.first,null,null,null,!0);c+=q;a=a.rest.rest}c+="};";null!==l&&(n=b(list("def",
f,l)));c=n+";"+c;return d?c+"; return "+f+";":c}if("defmacro"===h){c=b(a.rest.first);if("string"!=typeof c)return console.log("ERROR: Invalid macro name: "+c.toString()),"";k=a.rest.rest;g[c]=k;return""}l=a.first;e=a.rest;l=b(l,null,null,null,!0);if("recur"===l&&m)!1===f[0]&&(f[0]="__lisp__recur__$"+t,t+=3),l=f[0],a.first=l;else{if("super"===l)return e=y(e),c="this.__proto__.__proto__.constructor.call(this"+("()"===e?")":", "+e.slice(1)),(d?"return ":"")+c;if("string"===typeof l&&"super."===l.slice(0,
6)||"super["===l.slice(0,6))return e=y(e),c="this.__proto__.__proto__"+l.slice(5)+".call(this"+("()"===e?")":", "+e.slice(1)),(d?"return ":"")+c}c=l;"}"!==l[l.length-1]&&isNaN(l)||(c="("+c+")");if(l in g)return c=F(g[l],e),(d?"return ":"")+b(c);c+=y(e);return(d?"return ":"")+c}return isNaN(a)&&"'"!==a[0]&&'"'!==a[0]&&":"!==a[0]?(d?"return ":"")+C(a):(d?"return ":"")+a};s=function(a,g,f,d,e){for(var l="",h,c=!1;null!==a;){g&&null===a.rest&&(c=!0);h=b(a.first,null===a.rest?!0:!1,d,c);"string"===typeof h&&
(h=h.trim());"string"===typeof h&&0!==h.length&&";"!==h[h.length-1]&&(h+=";");if(f)if(node_environment)try{m=vm.runInContext(h,A,"lisp.vm"),e&&console.log(m)}catch(n){console.log(n)}else try{m=window.eval(h),e&&console.log(m)}catch(p){console.log(p)}l+=h;a=a.rest}return l};return{lexer:p,parser:r,compiler:b,lisp_compiler:s,compile:function(a,b){var f=p(a);if(null===f)return null;f=r(f);return s(f,!1,!0,null,b)},getEvalResult:function(){return m}}},lisp=lisp_module();
"undefined"!==typeof module&&(module.exports.compile=lisp.compile,module.exports.getEvalResult=lisp.getEvalResult);
